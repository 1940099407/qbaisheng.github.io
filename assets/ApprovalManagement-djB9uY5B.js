import{_ as le,r as p,o as oe,g as I,a as n,c as A,b as g,e as L,d as a,h as ne,w as o,i as h,j as w,f as d,t as J,F as re,k as O,E as T}from"./index-BMj814X_.js";const se={class:"approval-management"},pe={class:"operation-bar"},ue={key:1,class:"empty-state"},ie={__name:"ApprovalManagement",setup(de){const r=p([]),_=p([]),y=p([]),s=p("pending"),k=p(""),S=p(""),v=p(1),C=p(10),b=p(!1),c=p({remark:""}),V=p(null),j={leave:"运动打卡豁免",reimbursement:"学习打卡豁免",other:"其他打卡豁免"};oe(()=>{r.value=JSON.parse(localStorage.getItem("pendingApprovals")||"[]"),_.value=JSON.parse(localStorage.getItem("approvedApprovals")||"[]"),y.value=JSON.parse(localStorage.getItem("rejectedApprovals")||"[]"),r.value.length===0&&(r.value=[{id:"1",username:"张三",type:"leave",reason:"因感冒发烧，无法完成12月10日-12日的每日跑步打卡",date:"2025-12-08",submitTime:new Date(Date.now()-36e5).toLocaleString(),details:"豁免打卡类型：运动打卡；豁免日期：2025-12-10至2025-12-12；附医院诊断证明"},{id:"2",username:"李四",type:"reimbursement",reason:"因家中急事，无法完成12月8日的网课学习打卡",date:"2025-12-08",submitTime:new Date(Date.now()-72e5).toLocaleString(),details:"豁免打卡类型：学习打卡；豁免日期：2025-12-08；无相关证明（紧急事务）"}],localStorage.setItem("pendingApprovals",JSON.stringify(r.value)))});const B=I(()=>s.value==="pending"?r.value.length:s.value==="approved"?_.value.length:y.value.length),$=I(()=>{let e=[];if(s.value==="pending"&&(e=[...r.value]),s.value==="approved"&&(e=[..._.value]),s.value==="rejected"&&(e=[...y.value]),k.value){const m=k.value.toLowerCase();e=e.filter(u=>u.username.toLowerCase().includes(m)||u.reason.toLowerCase().includes(m))}S.value&&(e=e.filter(m=>m.type===S.value));const t=(v.value-1)*C.value;return e.slice(t,t+C.value)}),R=e=>({leave:"warning",reimbursement:"success",other:"info"})[e]||"default",U=()=>({pending:"暂无待审批的申请",approved:"暂无已通过的申请",rejected:"暂无已驳回的申请"})[s.value],E=()=>{v.value=1},F=()=>{v.value=1},K=()=>{v.value=1},q=e=>{C.value=e,v.value=1},H=e=>{v.value=e},P=e=>{O.confirm("确定通过该申请吗？","提示",{type:"success"}).then(()=>{r.value=r.value.filter(t=>t.id!==e.id),_.value.push({...e,status:"approved",approvalRemark:"审批通过",approvalTime:new Date().toLocaleString(),approver:"管理员"}),D(),T.success("审批已通过")})},G=e=>{V.value=e,c.value.remark="",b.value=!0},Q=()=>{if(!c.value.remark.trim()){T.warning("请输入驳回原因");return}r.value=r.value.filter(e=>e.id!==V.value.id),y.value.push({...V.value,status:"rejected",approvalRemark:c.value.remark,approvalTime:new Date().toLocaleString(),approver:"管理员"}),D(),b.value=!1,T.success("已驳回申请")},z=e=>{const t=`
    <div style="text-align: left; line-height: 1.8">
      <p><strong>申请人：</strong>${e.username}</p>
      <p><strong>申请类型：</strong>${j[e.type]}</p>
      <p><strong>申请日期：</strong>${e.date}</p>
      <p><strong>提交时间：</strong>${e.submitTime}</p>
      <p><strong>申请理由：</strong>${e.reason}</p>
      <p><strong>申请详情：</strong>${e.details||"无"}</p>
      ${e.status?`
        <p><strong>审批状态：</strong>${e.status==="approved"?"已通过":"已驳回"}</p>
        <p><strong>审批人：</strong>${e.approver}</p>
        <p><strong>审批时间：</strong>${e.approvalTime}</p>
        <p><strong>审批备注：</strong>${e.approvalRemark}</p>
      `:""}
    </div>
  `;O.alert(t,"申请详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"})},D=()=>{localStorage.setItem("pendingApprovals",JSON.stringify(r.value)),localStorage.setItem("approvedApprovals",JSON.stringify(_.value)),localStorage.setItem("rejectedApprovals",JSON.stringify(y.value))};return(e,t)=>{const m=n("el-input"),u=n("el-option"),M=n("el-select"),i=n("el-table-column"),N=n("el-tag"),f=n("el-button"),W=n("el-table"),X=n("el-pagination"),Y=n("el-empty"),Z=n("el-card"),ee=n("el-form-item"),te=n("el-form"),ae=n("el-dialog");return g(),A("div",se,[t[12]||(t[12]=L("h2",null,"审批管理",-1)),L("div",pe,[a(m,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),placeholder:"搜索申请人/申请理由","prefix-icons":"Search",class:"search-input",onKeyup:ne(F,["enter"])},null,8,["modelValue"]),a(M,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=l=>s.value=l),onChange:E},{default:o(()=>[a(u,{label:"待审批",value:"pending"}),a(u,{label:"已通过",value:"approved"}),a(u,{label:"已驳回",value:"rejected"})]),_:1},8,["modelValue"]),a(M,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=l=>S.value=l),placeholder:"申请类型",onChange:K},{default:o(()=>[a(u,{label:"全部类型",value:""}),a(u,{label:"运动打卡豁免（因病）",value:"leave"}),a(u,{label:"学习打卡豁免（因病）",value:"reimbursement"}),a(u,{label:"其他打卡豁免（因病）",value:"other"})]),_:1},8,["modelValue"])]),a(Z,null,{default:o(()=>[a(W,{data:$.value,border:"",style:{width:"100%"}},{default:o(()=>[a(i,{prop:"username",label:"申请人",width:"120"}),a(i,{prop:"type",label:"申请类型",width:"120"},{default:o(l=>[a(N,{type:R(l.row.type)},{default:o(()=>[d(J(j[l.row.type]||l.row.type),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"reason",label:"申请理由"}),a(i,{prop:"date",label:"申请日期",width:"150"}),a(i,{prop:"submitTime",label:"提交时间",width:"180"}),s.value!=="pending"?(g(),h(i,{key:0,prop:"status",label:"审批状态",width:"120"},{default:o(l=>[a(N,{type:l.row.status==="approved"?"success":"danger"},{default:o(()=>[d(J(l.row.status==="approved"?"已通过":"已驳回"),1)]),_:2},1032,["type"])]),_:1})):w("",!0),s.value!=="pending"?(g(),h(i,{key:1,prop:"approvalRemark",label:"审批备注",width:"200"})):w("",!0),a(i,{label:"操作",width:"240"},{default:o(l=>[s.value==="pending"?(g(),A(re,{key:0},[a(f,{size:"small",type:"success",onClick:x=>P(l.row)},{default:o(()=>[...t[6]||(t[6]=[d(" 通过 ",-1)])]),_:1},8,["onClick"]),a(f,{size:"small",type:"danger",onClick:x=>G(l.row)},{default:o(()=>[...t[7]||(t[7]=[d(" 驳回 ",-1)])]),_:1},8,["onClick"]),a(f,{size:"small",type:"info",onClick:x=>z(l.row)},{default:o(()=>[...t[8]||(t[8]=[d(" 详情 ",-1)])]),_:1},8,["onClick"])],64)):(g(),h(f,{key:1,size:"small",type:"info",onClick:x=>z(l.row)},{default:o(()=>[...t[9]||(t[9]=[d(" 查看详情 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"]),$.value.length>0?(g(),h(X,{key:0,onSizeChange:q,onCurrentChange:H,"current-page":v.value,"page-sizes":[5,10,20],"page-size":C.value,layout:"total, sizes, prev, pager, next",total:B.value,style:{"margin-top":"15px","text-align":"right"}},null,8,["current-page","page-size","total"])):w("",!0),$.value.length===0?(g(),A("div",ue,[a(Y,{description:U()},null,8,["description"])])):w("",!0)]),_:1}),a(ae,{title:"填写驳回理由",modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=l=>b.value=l),width:"400px"},{footer:o(()=>[a(f,{onClick:t[4]||(t[4]=l=>b.value=!1)},{default:o(()=>[...t[10]||(t[10]=[d("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:Q},{default:o(()=>[...t[11]||(t[11]=[d("确认驳回",-1)])]),_:1})]),default:o(()=>[a(te,{model:c.value},{default:o(()=>[a(ee,{label:"驳回原因",required:""},{default:o(()=>[a(m,{type:"textarea",modelValue:c.value.remark,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value.remark=l),placeholder:"请说明驳回原因（必填）",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},me=le(ie,[["__scopeId","data-v-0e482844"]]);export{me as default};
