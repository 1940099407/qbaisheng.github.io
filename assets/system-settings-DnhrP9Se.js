import{_ as ie,r as b,s as k,c as C,e as i,a as e,w as a,b as o,d as _,u as T,z as de,A as me,B as re,D as pe,j as N,i as A,f as p,G as fe,E as y,k as ce}from"./index-CiqgBVDf.js";const ge={class:"system-config-page"},be={key:0,class:"config-panel"},_e=["src"],ve={key:1,class:"config-panel"},ye={key:2,class:"config-panel"},Ve={key:3,class:"config-panel"},ke={__name:"system-settings",setup(Ce){const w=b("base"),d=k({systemName:"学健打卡系统",logoUrl:"",timezone:"Asia/Shanghai",language:"zh-CN",allowRegister:!0}),$=k({systemName:[{required:!0,message:"请输入系统名称",trigger:"blur"}],timezone:[{required:!0,message:"请选择时区",trigger:"change"}],language:[{required:!0,message:"请选择系统语言",trigger:"change"}]}),F=b([{id:1,name:"超级管理员",desc:"拥有系统全部权限"},{id:2,name:"活动管理员",desc:"管理活动及打卡数据"},{id:3,name:"普通用户",desc:"参与活动及打卡"}]),I=b([{id:"system",label:"系统管理",children:[{id:"system.config",label:"配置管理"},{id:"system.user",label:"用户管理"}]},{id:"activity",label:"活动管理",children:[{id:"activity.create",label:"创建活动"},{id:"activity.edit",label:"编辑活动"}]}]),x=b(!1),D=b(null),f=b([]),s=k({email:{enabled:!0,smtpServer:"smtp.qq.com",port:465,account:"notifications@example.com",password:""},sms:{enabled:!1}}),j=k({"email.smtpServer":[{required:!0,message:"请输入SMTP服务器",trigger:"blur"}],"email.port":[{required:!0,message:"请输入端口号",trigger:"blur"},{type:"number",message:"端口号必须为数字",trigger:"blur"}],"email.account":[{required:!0,message:"请输入发送账号",trigger:"blur"}],"email.password":[{required:!0,message:"请输入授权密码",trigger:"blur"}]}),E=k({checkin_remind:"亲爱的{{username}}，您参与的{{activityName}}活动今日尚未打卡，记得完成哦！",activity_start:"{{activityName}}活动已开始，点击查看详情并参与：{{link}}"}),S=b("checkin_remind"),m=k({backup:{enabled:!0,cycle:"weekly",keepCount:10},clean:{expiredCheckin:!1,checkinExpireDays:"90"}}),B=b(!1),G=u=>{w.value=u},H=u=>{u.code===200&&(d.logoUrl=u.data.url,y.success("Logo上传成功"))},J=()=>{setTimeout(()=>{y.success("基础设置保存成功")},500)},K=u=>{D.value=u,u.id===1?f.value=["system.config","system.user","activity.create","activity.edit"]:u.id===2?f.value=["activity.create","activity.edit"]:f.value=[],x.value=!0},O=(u,l,c)=>{l&&!c&&(f.value.includes(u.id)||f.value.push(u.id)),!l&&!c&&(f.value=f.value.filter(V=>V!==u.id))},Q=()=>{x.value=!1,y.success(`角色【${D.value.name}】权限保存成功`)},W=()=>{s.email.enabled||y.info("已关闭邮件通知，相关配置将不生效")},X=()=>{setTimeout(()=>{y.success("通知设置保存成功")},500)},Y=()=>{ce.confirm("确定要执行数据清理吗？清理后的数据将无法恢复","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{B.value=!0,setTimeout(()=>{B.value=!1,y.success("数据清理完成")},800)})},Z=()=>{setTimeout(()=>{y.success("数据管理规则保存成功")},500)};return(u,l)=>{const c=o("el-icon"),V=o("el-menu-item"),h=o("el-menu"),M=o("el-col"),v=o("el-input"),n=o("el-form-item"),g=o("el-button"),ee=o("el-upload"),r=o("el-option"),R=o("el-select"),L=o("el-radio"),le=o("el-radio-group"),U=o("el-switch"),q=o("el-form"),z=o("el-table-column"),ae=o("el-table"),te=o("el-tree"),oe=o("el-dialog"),ne=o("el-collapse-item"),se=o("el-collapse"),P=o("el-card"),ue=o("el-row");return _(),C("div",ge,[l[39]||(l[39]=i("div",{class:"page-title"},[i("h2",null,"系统配置管理"),i("p",null,"配置系统基础参数、权限规则及通知策略")],-1)),e(ue,{gutter:20,class:"config-container"},{default:a(()=>[e(M,{span:6,class:"config-sidebar"},{default:a(()=>[e(h,{"default-active":"base",class:"config-menu",onSelect:G},{default:a(()=>[e(V,{index:"base"},{default:a(()=>[e(c,null,{default:a(()=>[e(T(de))]),_:1}),l[19]||(l[19]=i("span",null,"基础设置",-1))]),_:1}),e(V,{index:"permission"},{default:a(()=>[e(c,null,{default:a(()=>[e(T(me))]),_:1}),l[20]||(l[20]=i("span",null,"权限管理",-1))]),_:1}),e(V,{index:"notification"},{default:a(()=>[e(c,null,{default:a(()=>[e(T(re))]),_:1}),l[21]||(l[21]=i("span",null,"通知设置",-1))]),_:1}),e(V,{index:"data"},{default:a(()=>[e(c,null,{default:a(()=>[e(T(pe))]),_:1}),l[22]||(l[22]=i("span",null,"数据管理",-1))]),_:1})]),_:1})]),_:1}),e(M,{span:18,class:"config-content"},{default:a(()=>[w.value==="base"?(_(),C("div",be,[l[27]||(l[27]=i("h3",null,"基础系统参数",-1)),e(q,{ref:"baseForm",model:d,rules:$,"label-width":"150px",class:"config-form"},{default:a(()=>[e(n,{label:"系统名称",prop:"systemName"},{default:a(()=>[e(v,{modelValue:d.systemName,"onUpdate:modelValue":l[0]||(l[0]=t=>d.systemName=t),placeholder:"输入系统名称（如：学健打卡平台）"},null,8,["modelValue"])]),_:1}),e(n,{label:"系统Logo"},{default:a(()=>[e(ee,{action:"/api/upload/logo","list-type":"picture","show-file-list":!1,"on-success":H},{default:a(()=>[d.logoUrl?(_(),C("img",{key:0,src:d.logoUrl,class:"logo-preview"},null,8,_e)):(_(),A(g,{key:1,type:"primary"},{default:a(()=>[e(c,null,{default:a(()=>[e(T(fe))]),_:1}),l[23]||(l[23]=p(" 上传Logo ",-1))]),_:1}))]),_:1})]),_:1}),e(n,{label:"默认时区",prop:"timezone"},{default:a(()=>[e(R,{modelValue:d.timezone,"onUpdate:modelValue":l[1]||(l[1]=t=>d.timezone=t),placeholder:"选择时区"},{default:a(()=>[e(r,{label:"UTC+8 北京时间",value:"Asia/Shanghai"}),e(r,{label:"UTC+0 格林尼治时间",value:"UTC"})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"系统语言",prop:"language"},{default:a(()=>[e(le,{modelValue:d.language,"onUpdate:modelValue":l[2]||(l[2]=t=>d.language=t)},{default:a(()=>[e(L,{label:"zh-CN"},{default:a(()=>[...l[24]||(l[24]=[p("简体中文",-1)])]),_:1}),e(L,{label:"en-US"},{default:a(()=>[...l[25]||(l[25]=[p("英文",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"是否开放注册",prop:"allowRegister"},{default:a(()=>[e(U,{modelValue:d.allowRegister,"onUpdate:modelValue":l[3]||(l[3]=t=>d.allowRegister=t),"active-text":"允许","inactive-text":"禁止"},null,8,["modelValue"])]),_:1}),e(n,null,{default:a(()=>[e(g,{type:"primary",onClick:J},{default:a(()=>[...l[26]||(l[26]=[p("保存设置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])):N("",!0),w.value==="permission"?(_(),C("div",ve,[l[31]||(l[31]=i("h3",null,"角色权限配置",-1)),e(ae,{data:F.value,border:"",style:{"margin-bottom":"20px"}},{default:a(()=>[e(z,{prop:"id",label:"角色ID",width:"80"}),e(z,{prop:"name",label:"角色名称"}),e(z,{prop:"desc",label:"角色描述"}),e(z,{label:"操作",width:"180"},{default:a(t=>[e(g,{size:"small",onClick:we=>K(t.row)},{default:a(()=>[...l[28]||(l[28]=[p("编辑权限",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(oe,{title:"编辑角色权限",modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=t=>x.value=t),width:"600px"},{footer:a(()=>[e(g,{onClick:l[4]||(l[4]=t=>x.value=!1)},{default:a(()=>[...l[29]||(l[29]=[p("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:Q},{default:a(()=>[...l[30]||(l[30]=[p("保存权限",-1)])]),_:1})]),default:a(()=>[e(te,{data:I.value,"show-checkbox":"","node-key":"id","default-checked-keys":f.value,onCheckChange:O},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"])])):N("",!0),w.value==="notification"?(_(),C("div",ye,[l[33]||(l[33]=i("h3",null,"通知渠道配置",-1)),e(q,{model:s,rules:j,"label-width":"150px",class:"config-form"},{default:a(()=>[e(n,{label:"邮件通知"},{default:a(()=>[e(U,{modelValue:s.email.enabled,"onUpdate:modelValue":l[6]||(l[6]=t=>s.email.enabled=t),onChange:W},null,8,["modelValue"]),s.email.enabled?(_(),A(se,{key:0},{default:a(()=>[e(ne,{title:"邮件服务器配置"},{default:a(()=>[e(n,{label:"SMTP服务器",prop:"email.smtpServer"},{default:a(()=>[e(v,{modelValue:s.email.smtpServer,"onUpdate:modelValue":l[7]||(l[7]=t=>s.email.smtpServer=t)},null,8,["modelValue"])]),_:1}),e(n,{label:"端口",prop:"email.port"},{default:a(()=>[e(v,{modelValue:s.email.port,"onUpdate:modelValue":l[8]||(l[8]=t=>s.email.port=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),e(n,{label:"发送账号",prop:"email.account"},{default:a(()=>[e(v,{modelValue:s.email.account,"onUpdate:modelValue":l[9]||(l[9]=t=>s.email.account=t)},null,8,["modelValue"])]),_:1}),e(n,{label:"授权密码",prop:"email.password"},{default:a(()=>[e(v,{modelValue:s.email.password,"onUpdate:modelValue":l[10]||(l[10]=t=>s.email.password=t),type:"password"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):N("",!0)]),_:1}),e(n,{label:"短信通知"},{default:a(()=>[e(U,{modelValue:s.sms.enabled,"onUpdate:modelValue":l[11]||(l[11]=t=>s.sms.enabled=t)},null,8,["modelValue"])]),_:1}),e(n,{label:"通知模板"},{default:a(()=>[e(R,{modelValue:S.value,"onUpdate:modelValue":l[12]||(l[12]=t=>S.value=t),placeholder:"选择通知类型"},{default:a(()=>[e(r,{label:"打卡提醒",value:"checkin_remind"}),e(r,{label:"活动开始",value:"activity_start"})]),_:1},8,["modelValue"]),e(v,{modelValue:E[S.value],"onUpdate:modelValue":l[13]||(l[13]=t=>E[S.value]=t),type:"textarea",rows:"4",placeholder:"使用{{变量名}}插入动态内容（如：{{username}}、{{activityName}}）",style:{"margin-top":"10px"}},null,8,["modelValue"])]),_:1}),e(n,null,{default:a(()=>[e(g,{type:"primary",onClick:X},{default:a(()=>[...l[32]||(l[32]=[p("保存配置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])):N("",!0),w.value==="data"?(_(),C("div",Ve,[l[38]||(l[38]=i("h3",null,"数据备份与清理",-1)),e(P,null,{default:a(()=>[l[34]||(l[34]=i("h4",null,"自动备份设置",-1)),e(q,{model:m.backup,"label-width":"150px",class:"config-form"},{default:a(()=>[e(n,{label:"启用自动备份"},{default:a(()=>[e(U,{modelValue:m.backup.enabled,"onUpdate:modelValue":l[14]||(l[14]=t=>m.backup.enabled=t)},null,8,["modelValue"])]),_:1}),e(n,{label:"备份周期"},{default:a(()=>[e(R,{modelValue:m.backup.cycle,"onUpdate:modelValue":l[15]||(l[15]=t=>m.backup.cycle=t)},{default:a(()=>[e(r,{label:"每日",value:"daily"}),e(r,{label:"每周",value:"weekly"}),e(r,{label:"每月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"保留备份数量"},{default:a(()=>[e(v,{modelValue:m.backup.keepCount,"onUpdate:modelValue":l[16]||(l[16]=t=>m.backup.keepCount=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(P,{style:{"margin-top":"20px"}},{default:a(()=>[l[37]||(l[37]=i("h4",null,"数据清理规则",-1)),e(q,{model:m.clean,"label-width":"150px",class:"config-form"},{default:a(()=>[e(n,{label:"清理过期打卡数据"},{default:a(()=>[e(U,{modelValue:m.clean.expiredCheckin,"onUpdate:modelValue":l[17]||(l[17]=t=>m.clean.expiredCheckin=t)},null,8,["modelValue"]),e(R,{modelValue:m.clean.checkinExpireDays,"onUpdate:modelValue":l[18]||(l[18]=t=>m.clean.checkinExpireDays=t),style:{"margin-left":"10px"}},{default:a(()=>[e(r,{label:"30天前",value:"30"}),e(r,{label:"90天前",value:"90"}),e(r,{label:"180天前",value:"180"})]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:a(()=>[e(g,{type:"warning",onClick:Y,loading:B.value},{default:a(()=>[...l[35]||(l[35]=[p(" 立即执行清理 ",-1)])]),_:1},8,["loading"]),e(g,{type:"primary",style:{"margin-left":"10px"},onClick:Z},{default:a(()=>[...l[36]||(l[36]=[p(" 保存规则 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])):N("",!0)]),_:1})]),_:1})])}}},Ue=ie(ke,[["__scopeId","data-v-d82eb870"]]);export{Ue as default};
