import{_ as fe,r as f,g as _e,s as be,c as _,e as $,a as t,w as a,b as m,d as s,F as x,v as k,i as c,f as p,u as B,x as P,t as q,p as ge,j as L,y as Ve,h as he,E as T,k as xe}from"./index-CiqgBVDf.js";const ke={class:"custom-forms-page"},we={class:"page-header"},Ce={class:"header-actions"},Ue={class:"field-basic"},$e={key:0,class:"field-advanced"},Te={class:"preview-container"},Ie={style:{"text-align":"center","margin-bottom":"20px"}},qe={__name:"custom-forms",setup(Le){const O=f([{id:1,name:"打卡表单"},{id:2,name:"评估表单"},{id:3,name:"反馈表单"},{id:4,name:"报名表单"}]),g=f([{id:1,name:"日常打卡模板",categoryId:1,fields:[{label:"打卡内容",type:"text",required:!0,placeholder:"请输入今日打卡内容",maxLength:100},{label:"时长(分钟)",type:"number",required:!0,min:5,max:1440},{label:"完成情况",type:"radio",required:!0,options:["全部完成","部分完成","未完成"]}],createTime:"2023-06-15 10:30",usedCount:128},{id:2,name:"月度评估表",categoryId:2,fields:[{label:"本月目标",type:"text",required:!0,placeholder:"请输入本月目标"},{label:"完成度",type:"number",required:!0,min:0,max:100,placeholder:"0-100之间的数字"},{label:"下月计划",type:"textarea",required:!1,maxLength:500}],createTime:"2023-06-01 09:15",usedCount:56}]),F=f(""),D=f(""),G=_e(()=>g.value.filter(n=>{const e=n.name.includes(F.value),r=!D.value||n.categoryId===D.value;return e&&r})),w=f(!1),S=f(!1),N=f(!1),V=f(-1),C=f(""),d=be({id:null,name:"",categoryId:null,fields:[{label:"",type:"text",required:!1,placeholder:"",options:[],min:null,max:null,maxLength:0}]}),z=f({}),v=f({}),H={name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],categoryId:[{required:!0,message:"请选择分类",trigger:"change"}]},Q=()=>{d.fields.push({label:"",type:"text",required:!1,placeholder:"",options:[],min:null,max:null,maxLength:0})},W=n=>{d.fields.splice(n,1),V.value===n&&(V.value=-1)},X=n=>{const e=d.fields[n];["radio","checkbox"].includes(e.type)||(e.options=[]),e.type!=="number"&&(e.min=null,e.max=null),["text","textarea"].includes(e.type)||(e.maxLength=0)},E=n=>{C.value.trim()&&(d.fields[n].options.push(C.value.trim()),C.value="")},Y=(n,e)=>{d.fields[n].options.splice(e,1)},Z=n=>{N.value=!0,Object.assign(d,JSON.parse(JSON.stringify(n))),V.value=-1,w.value=!0},ee=n=>{const e=JSON.parse(JSON.stringify(n));e.id=Date.now(),e.name=`${n.name}_副本`,e.createTime=new Date().toLocaleString(),e.usedCount=0,g.value.push(e),T.success("模板复制成功")},le=n=>{z.value=JSON.parse(JSON.stringify(n));const e={};n.fields.forEach((r,I)=>{const i=`field_${I}`;r.type==="checkbox"?e[i]=[]:r.type==="date"?e[i]=null:r.type==="radio"&&r.options.length>0?e[i]=r.options[0]:e[i]=""}),v.value=e,S.value=!0},te=n=>{const e=g.value.find(r=>r.id===n);xe.confirm(`确定要删除模板"${e.name}"吗？删除后将无法恢复`,"确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{g.value=g.value.filter(r=>r.id!==n),T.success("模板已删除")})},ae=()=>{if(!d.name||!d.categoryId){T.error("请完善模板名称和分类信息");return}if(!d.fields.some(e=>["radio","checkbox"].includes(e.type)&&e.options.length===0?(T.error(`字段"${e.label}"需配置至少一个选项`),!0):!1)){if(N.value){const e=g.value.findIndex(r=>r.id===d.id);e!==-1&&(g.value[e]={...d}),T.success("模板更新成功")}else d.id=Date.now(),d.createTime=new Date().toLocaleString(),d.usedCount=0,g.value.push({...d}),T.success("模板创建成功");w.value=!1,oe()}},oe=()=>{d.id=null,d.name="",d.categoryId=null,d.fields=[{label:"",type:"text",required:!1,placeholder:"",options:[],min:null,max:null,maxLength:0}],N.value=!1,V.value=-1,C.value=""};let M=null;const ne=n=>{F.value=n,clearTimeout(M),M=setTimeout(()=>{},300)},ue=()=>{},de=n=>{const e=O.value.find(r=>r.id===n.categoryId);return e?e.name:"未分类"};return(n,e)=>{const r=m("el-option"),I=m("el-select"),i=m("el-input"),J=m("el-icon"),y=m("el-button"),h=m("el-table-column"),re=m("el-table"),se=m("el-card"),b=m("el-form-item"),K=m("el-checkbox"),me=m("el-divider"),j=m("el-col"),ie=m("el-row"),R=m("el-form"),A=m("el-dialog"),pe=m("el-radio"),ce=m("el-radio-group"),ve=m("el-checkbox-group"),ye=m("el-date-picker");return s(),_("div",ke,[$("div",we,[e[11]||(e[11]=$("h2",null,"自定义表单与模板管理",-1)),$("div",Ce,[t(I,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=l=>D.value=l),placeholder:"所有分类",style:{width:"160px","margin-right":"10px"},onChange:ue},{default:a(()=>[t(r,{label:"所有分类",value:""}),(s(!0),_(x,null,k(O.value,l=>(s(),c(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(i,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=l=>F.value=l),placeholder:"搜索模板名称",style:{width:"200px","margin-right":"10px"},clearable:"",onInput:ne},null,8,["modelValue"]),t(y,{type:"primary",onClick:e[2]||(e[2]=l=>w.value=!0)},{default:a(()=>[t(J,null,{default:a(()=>[t(B(P))]),_:1}),e[10]||(e[10]=p(" 新增表单模板 ",-1))]),_:1})])]),t(se,null,{default:a(()=>[t(re,{data:G.value,border:"",style:{width:"100%"},"empty-text":"暂无模板数据，请点击新增按钮创建"},{default:a(()=>[t(h,{type:"index",label:"序号",width:"60"}),t(h,{prop:"name",label:"模板名称",width:"200"}),t(h,{prop:"categoryId",label:"所属分类",width:"120",formatter:de}),t(h,{label:"字段数量",width:"100"},{default:a(l=>[p(q(l.row.fields.length),1)]),_:1}),t(h,{prop:"createTime",label:"创建时间",width:"180"}),t(h,{prop:"usedCount",label:"使用次数",width:"100"}),t(h,{label:"操作",width:"280"},{default:a(l=>[t(y,{size:"small",onClick:u=>le(l.row)},{default:a(()=>[...e[12]||(e[12]=[p("预览",-1)])]),_:1},8,["onClick"]),t(y,{size:"small",type:"primary",onClick:u=>Z(l.row)},{default:a(()=>[...e[13]||(e[13]=[p("编辑",-1)])]),_:1},8,["onClick"]),t(y,{size:"small",type:"success",onClick:u=>ee(l.row)},{default:a(()=>[...e[14]||(e[14]=[p("复制",-1)])]),_:1},8,["onClick"]),t(y,{size:"small",type:"danger",onClick:u=>te(l.row.id),disabled:l.row.usedCount>0},{default:a(()=>[...e[15]||(e[15]=[p(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),t(A,{title:N.value?"编辑表单模板":"新增表单模板",modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=l=>w.value=l),width:"700px","destroy-on-close":!0},{footer:a(()=>[t(y,{onClick:e[6]||(e[6]=l=>w.value=!1)},{default:a(()=>[...e[20]||(e[20]=[p("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:ae},{default:a(()=>[...e[21]||(e[21]=[p("保存",-1)])]),_:1})]),default:a(()=>[t(R,{ref:"formTemplateRef",model:d,"label-width":"100px",rules:H,class:"form-template"},{default:a(()=>[t(b,{label:"模板名称",prop:"name"},{default:a(()=>[t(i,{modelValue:d.name,"onUpdate:modelValue":e[3]||(e[3]=l=>d.name=l),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),t(b,{label:"所属分类",prop:"categoryId"},{default:a(()=>[t(I,{modelValue:d.categoryId,"onUpdate:modelValue":e[4]||(e[4]=l=>d.categoryId=l),placeholder:"请选择分类"},{default:a(()=>[(s(!0),_(x,null,k(O.value,l=>(s(),c(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"表单字段"},{default:a(()=>[(s(!0),_(x,null,k(d.fields,(l,u)=>(s(),_("div",{key:u,class:ge(["field-item",{"field-item-active":V.value===u}])},[$("div",Ue,[t(i,{modelValue:l.label,"onUpdate:modelValue":o=>l.label=o,placeholder:"字段标签",style:{width:"150px","margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),t(I,{modelValue:l.type,"onUpdate:modelValue":o=>l.type=o,style:{width:"150px","margin-right":"10px"},placeholder:"字段类型",onChange:o=>X(u)},{default:a(()=>[t(r,{label:"文本",value:"text"}),t(r,{label:"数字",value:"number"}),t(r,{label:"单选",value:"radio"}),t(r,{label:"多选",value:"checkbox"}),t(r,{label:"日期",value:"date"}),t(r,{label:"多行文本",value:"textarea"})]),_:1},8,["modelValue","onUpdate:modelValue","onChange"]),t(K,{modelValue:l.required,"onUpdate:modelValue":o=>l.required=o,label:"必填",style:{"margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),t(y,{type:"danger",size:"small",icon:"Delete",onClick:o=>W(u),disabled:d.fields.length<=1},null,8,["onClick","disabled"]),t(y,{type:"text",size:"small",onClick:o=>V.value=u},{default:a(()=>[...e[16]||(e[16]=[p(" 高级设置 ",-1)])]),_:1},8,["onClick"])]),V.value===u?(s(),_("div",$e,[t(me,{"content-position":"left"},{default:a(()=>[...e[17]||(e[17]=[p("高级设置",-1)])]),_:1}),t(b,{label:"占位提示",prop:"placeholder"},{default:a(()=>[t(i,{modelValue:l.placeholder,"onUpdate:modelValue":o=>l.placeholder=o,placeholder:"例如：请输入内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),["radio","checkbox"].includes(l.type)?(s(),c(b,{key:0,label:"选项配置"},{default:a(()=>[(s(!0),_(x,null,k(l.options,(o,U)=>(s(),c(B(Ve),{key:U,closable:"",onClose:Fe=>Y(u,U)},{default:a(()=>[p(q(o),1)]),_:2},1032,["onClose"]))),128)),t(i,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=o=>C.value=o),placeholder:"添加选项",style:{width:"200px","margin-top":"10px"},onKeyup:he(o=>E(u),["enter"])},null,8,["modelValue","onKeyup"]),t(y,{type:"text",size:"small",onClick:o=>E(u),style:{"vertical-align":"bottom"}},{default:a(()=>[...e[18]||(e[18]=[p(" 添加 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)):L("",!0),l.type==="number"?(s(),c(ie,{key:1,gutter:10},{default:a(()=>[t(j,{span:12},{default:a(()=>[t(b,{label:"最小值"},{default:a(()=>[t(i,{modelValue:l.min,"onUpdate:modelValue":o=>l.min=o,modelModifiers:{number:!0},type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(j,{span:12},{default:a(()=>[t(b,{label:"最大值"},{default:a(()=>[t(i,{modelValue:l.max,"onUpdate:modelValue":o=>l.max=o,modelModifiers:{number:!0},type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):L("",!0),["text","textarea"].includes(l.type)?(s(),c(b,{key:2,label:"最大长度"},{default:a(()=>[t(i,{modelValue:l.maxLength,"onUpdate:modelValue":o=>l.maxLength=o,modelModifiers:{number:!0},type:"number",placeholder:"0表示不限制"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):L("",!0)])):L("",!0)],2))),128)),t(y,{type:"text",onClick:Q,style:{"margin-top":"10px"}},{default:a(()=>[t(J,null,{default:a(()=>[t(B(P))]),_:1}),e[19]||(e[19]=p(" 添加字段 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(A,{title:"表单预览",modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=l=>S.value=l),width:"600px"},{footer:a(()=>[t(y,{onClick:e[8]||(e[8]=l=>S.value=!1)},{default:a(()=>[...e[22]||(e[22]=[p("关闭预览",-1)])]),_:1})]),default:a(()=>[$("div",Te,[$("h3",Ie,q(z.value.name),1),t(R,{model:v.value,"label-width":"100px"},{default:a(()=>[(s(!0),_(x,null,k(z.value.fields,(l,u)=>(s(),c(b,{key:u,label:l.label,required:l.required},{default:a(()=>[l.type==="text"?(s(),c(i,{key:0,modelValue:v.value[`field_${u}`],"onUpdate:modelValue":o=>v.value[`field_${u}`]=o,placeholder:l.placeholder,maxlength:l.maxLength||void 0},null,8,["modelValue","onUpdate:modelValue","placeholder","maxlength"])):l.type==="number"?(s(),c(i,{key:1,modelValue:v.value[`field_${u}`],"onUpdate:modelValue":o=>v.value[`field_${u}`]=o,modelModifiers:{number:!0},type:"number",placeholder:l.placeholder,min:l.min,max:l.max},null,8,["modelValue","onUpdate:modelValue","placeholder","min","max"])):l.type==="radio"?(s(),c(ce,{key:2,modelValue:v.value[`field_${u}`],"onUpdate:modelValue":o=>v.value[`field_${u}`]=o},{default:a(()=>[(s(!0),_(x,null,k(l.options,(o,U)=>(s(),c(pe,{key:U,label:o,style:{"margin-right":"15px"}},{default:a(()=>[p(q(o),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.type==="checkbox"?(s(),c(ve,{key:3,modelValue:v.value[`field_${u}`],"onUpdate:modelValue":o=>v.value[`field_${u}`]=o},{default:a(()=>[(s(!0),_(x,null,k(l.options,(o,U)=>(s(),c(K,{key:U,label:o,style:{"margin-right":"15px"}},{default:a(()=>[p(q(o),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.type==="date"?(s(),c(ye,{key:4,modelValue:v.value[`field_${u}`],"onUpdate:modelValue":o=>v.value[`field_${u}`]=o,type:"date",placeholder:l.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])):l.type==="textarea"?(s(),c(i,{key:5,modelValue:v.value[`field_${u}`],"onUpdate:modelValue":o=>v.value[`field_${u}`]=o,type:"textarea",placeholder:l.placeholder,maxlength:l.maxLength||void 0,rows:"3"},null,8,["modelValue","onUpdate:modelValue","placeholder","maxlength"])):L("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},Se=fe(qe,[["__scopeId","data-v-8384ba60"]]);export{Se as default};
