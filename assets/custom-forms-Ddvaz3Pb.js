import{_ as ce,r as c,g as ve,s as fe,a as i,c as b,b as s,e as w,d as l,w as a,F as T,v as U,i as g,f as m,u as O,x as R,t as z,p as ye,j as L,y as be,h as ge,z as _e,E as k,k as xe}from"./index-Bua01rXW.js";const Ve={class:"custom-forms-page"},he={class:"page-header"},we={class:"header-actions"},ke={class:"field-basic"},Ce={key:0,class:"field-advanced"},Te={class:"preview-container"},Ue={style:{"text-align":"center","margin-bottom":"20px"}},$e={__name:"custom-forms",setup(Ie){const A=o=>{switch(o){case"text":return"el-input";case"number":return"el-input-number";case"radio":return"el-radio-group";case"checkbox":return"el-checkbox-group";case"date":return"el-date-picker";case"textarea":return"el-input";default:return"el-input"}},S=c([{id:1,name:"打卡表单"},{id:2,name:"评估表单"},{id:3,name:"反馈表单"},{id:4,name:"报名表单"}]),f=c([{id:1,name:"日常打卡模板",categoryId:1,fields:[{label:"打卡内容",type:"text",required:!0,placeholder:"请输入今日打卡内容",maxLength:100},{label:"时长(分钟)",type:"number",required:!0,min:5,max:1440},{label:"完成情况",type:"radio",required:!0,options:["全部完成","部分完成","未完成"]}],createTime:"2023-06-15 10:30",usedCount:128},{id:2,name:"月度评估表",categoryId:2,fields:[{label:"本月目标",type:"text",required:!0,placeholder:"请输入本月目标"},{label:"完成度",type:"number",required:!0,min:0,max:100,placeholder:"0-100之间的数字"},{label:"下月计划",type:"textarea",required:!1,maxLength:500}],createTime:"2023-06-01 09:15",usedCount:56}]),$=c(""),I=c(""),G=ve(()=>f.value.filter(o=>{const e=o.name.includes($.value),r=!I.value||o.categoryId===I.value;return e&&r})),V=c(!1),q=c(!1),D=c(!1),_=c(-1),h=c(""),n=fe({id:null,name:"",categoryId:null,fields:[{label:"",type:"text",required:!1,placeholder:"",options:[],min:null,max:null,maxLength:0}]}),N=c({}),F=c({}),H={name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],categoryId:[{required:!0,message:"请选择分类",trigger:"change"}]},Q=()=>{n.fields.push({label:"",type:"text",required:!1,placeholder:"",options:[],min:null,max:null,maxLength:0})},W=o=>{n.fields.splice(o,1),_.value===o&&(_.value=-1)},X=o=>{const e=n.fields[o];["radio","checkbox"].includes(e.type)||(e.options=[]),e.type!=="number"&&(e.min=null,e.max=null),["text","textarea"].includes(e.type)||(e.maxLength=0)},B=o=>{h.value.trim()&&(n.fields[o].options.push(h.value.trim()),h.value="")},Y=(o,e)=>{n.fields[o].options.splice(e,1)},Z=o=>{D.value=!0,Object.assign(n,JSON.parse(JSON.stringify(o))),_.value=-1,V.value=!0},ee=o=>{const e=JSON.parse(JSON.stringify(o));e.id=Date.now(),e.name=`${o.name}_副本`,e.createTime=new Date().toLocaleString(),e.usedCount=0,f.value.push(e),k.success("模板复制成功")},le=o=>{N.value=JSON.parse(JSON.stringify(o));const e={};o.fields.forEach((r,C)=>{e[`field_${C}`]=r.type==="checkbox"?[]:r.type==="date"?null:""}),F.value=e,q.value=!0},te=o=>{const e=f.value.find(r=>r.id===o);xe.confirm(`确定要删除模板"${e.name}"吗？删除后将无法恢复`,"确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{f.value=f.value.filter(r=>r.id!==o),k.success("模板已删除")})},ae=()=>{if(!n.name||!n.categoryId){k.error("请完善模板名称和分类信息");return}if(!n.fields.some(e=>["radio","checkbox"].includes(e.type)&&e.options.length===0?(k.error(`字段"${e.label}"需配置至少一个选项`),!0):!1)){if(D.value){const e=f.value.findIndex(r=>r.id===n.id);e!==-1&&(f.value[e]={...n}),k.success("模板更新成功")}else n.id=Date.now(),n.createTime=new Date().toLocaleString(),n.usedCount=0,f.value.push({...n}),k.success("模板创建成功");V.value=!1,oe()}},oe=()=>{n.id=null,n.name="",n.categoryId=null,n.fields=[{label:"",type:"text",required:!1,placeholder:"",options:[],min:null,max:null,maxLength:0}],D.value=!1,_.value=-1,h.value=""};let E=null;const ne=o=>{$.value=o,clearTimeout(E),E=setTimeout(()=>{},300)},ue=()=>{},re=o=>{const e=S.value.find(r=>r.id===o.categoryId);return e?e.name:"未分类"};return(o,e)=>{const r=i("el-option"),C=i("el-select"),y=i("el-input"),J=i("el-icon"),p=i("el-button"),x=i("el-table-column"),de=i("el-table"),se=i("el-card"),v=i("el-form-item"),ie=i("el-checkbox"),me=i("el-divider"),M=i("el-col"),pe=i("el-row"),K=i("el-form"),j=i("el-dialog");return s(),b("div",Ve,[w("div",he,[e[11]||(e[11]=w("h2",null,"自定义表单与模板管理",-1)),w("div",we,[l(C,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=t=>I.value=t),placeholder:"所有分类",style:{width:"160px","margin-right":"10px"},onChange:ue},{default:a(()=>[l(r,{label:"所有分类",value:""}),(s(!0),b(T,null,U(S.value,t=>(s(),g(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(y,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=t=>$.value=t),placeholder:"搜索模板名称",style:{width:"200px","margin-right":"10px"},clearable:"",onInput:ne},null,8,["modelValue"]),l(p,{type:"primary",onClick:e[2]||(e[2]=t=>V.value=!0)},{default:a(()=>[l(J,null,{default:a(()=>[l(O(R))]),_:1}),e[10]||(e[10]=m(" 新增表单模板 ",-1))]),_:1})])]),l(se,null,{default:a(()=>[l(de,{data:G.value,border:"",style:{width:"100%"},"empty-text":"暂无模板数据，请点击新增按钮创建"},{default:a(()=>[l(x,{type:"index",label:"序号",width:"60"}),l(x,{prop:"name",label:"模板名称",width:"200"}),l(x,{prop:"categoryId",label:"所属分类",width:"120",formatter:re}),l(x,{label:"字段数量",width:"100"},{default:a(t=>[m(z(t.row.fields.length),1)]),_:1}),l(x,{prop:"createTime",label:"创建时间",width:"180"}),l(x,{prop:"usedCount",label:"使用次数",width:"100"}),l(x,{label:"操作",width:"280"},{default:a(t=>[l(p,{size:"small",onClick:d=>le(t.row)},{default:a(()=>[...e[12]||(e[12]=[m("预览",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"primary",onClick:d=>Z(t.row)},{default:a(()=>[...e[13]||(e[13]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"success",onClick:d=>ee(t.row)},{default:a(()=>[...e[14]||(e[14]=[m("复制",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"danger",onClick:d=>te(t.row.id),disabled:t.row.usedCount>0},{default:a(()=>[...e[15]||(e[15]=[m(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),l(j,{title:D.value?"编辑表单模板":"新增表单模板",modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=t=>V.value=t),width:"700px","destroy-on-close":!0},{footer:a(()=>[l(p,{onClick:e[6]||(e[6]=t=>V.value=!1)},{default:a(()=>[...e[20]||(e[20]=[m("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:ae},{default:a(()=>[...e[21]||(e[21]=[m("保存",-1)])]),_:1})]),default:a(()=>[l(K,{ref:"formTemplateRef",model:n,"label-width":"100px",rules:H,class:"form-template"},{default:a(()=>[l(v,{label:"模板名称",prop:"name"},{default:a(()=>[l(y,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=t=>n.name=t),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"所属分类",prop:"categoryId"},{default:a(()=>[l(C,{modelValue:n.categoryId,"onUpdate:modelValue":e[4]||(e[4]=t=>n.categoryId=t),placeholder:"请选择分类"},{default:a(()=>[(s(!0),b(T,null,U(S.value,t=>(s(),g(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"表单字段"},{default:a(()=>[(s(!0),b(T,null,U(n.fields,(t,d)=>(s(),b("div",{key:d,class:ye(["field-item",{"field-item-active":_.value===d}])},[w("div",ke,[l(y,{modelValue:t.label,"onUpdate:modelValue":u=>t.label=u,placeholder:"字段标签",style:{width:"150px","margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),l(C,{modelValue:t.type,"onUpdate:modelValue":u=>t.type=u,style:{width:"150px","margin-right":"10px"},placeholder:"字段类型",onChange:u=>X(d)},{default:a(()=>[l(r,{label:"文本",value:"text"}),l(r,{label:"数字",value:"number"}),l(r,{label:"单选",value:"radio"}),l(r,{label:"多选",value:"checkbox"}),l(r,{label:"日期",value:"date"}),l(r,{label:"多行文本",value:"textarea"})]),_:1},8,["modelValue","onUpdate:modelValue","onChange"]),l(ie,{modelValue:t.required,"onUpdate:modelValue":u=>t.required=u,label:"必填",style:{"margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),l(p,{type:"danger",size:"small",icon:"Delete",onClick:u=>W(d),disabled:n.fields.length<=1},null,8,["onClick","disabled"]),l(p,{type:"text",size:"small",onClick:u=>_.value=d},{default:a(()=>[...e[16]||(e[16]=[m(" 高级设置 ",-1)])]),_:1},8,["onClick"])]),_.value===d?(s(),b("div",Ce,[l(me,{"content-position":"left"},{default:a(()=>[...e[17]||(e[17]=[m("高级设置",-1)])]),_:1}),l(v,{label:"占位提示",prop:"placeholder"},{default:a(()=>[l(y,{modelValue:t.placeholder,"onUpdate:modelValue":u=>t.placeholder=u,placeholder:"例如：请输入内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),["radio","checkbox"].includes(t.type)?(s(),g(v,{key:0,label:"选项配置"},{default:a(()=>[(s(!0),b(T,null,U(t.options,(u,P)=>(s(),g(O(be),{key:P,closable:"",onClose:qe=>Y(d,P)},{default:a(()=>[m(z(u),1)]),_:2},1032,["onClose"]))),128)),l(y,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=u=>h.value=u),placeholder:"添加选项",style:{width:"200px","margin-top":"10px"},onKeyup:ge(u=>B(d),["enter"])},null,8,["modelValue","onKeyup"]),l(p,{type:"text",size:"small",onClick:u=>B(d),style:{"vertical-align":"bottom"}},{default:a(()=>[...e[18]||(e[18]=[m(" 添加 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)):L("",!0),t.type==="number"?(s(),g(pe,{key:1,gutter:10},{default:a(()=>[l(M,{span:12},{default:a(()=>[l(v,{label:"最小值"},{default:a(()=>[l(y,{modelValue:t.min,"onUpdate:modelValue":u=>t.min=u,modelModifiers:{number:!0},type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l(M,{span:12},{default:a(()=>[l(v,{label:"最大值"},{default:a(()=>[l(y,{modelValue:t.max,"onUpdate:modelValue":u=>t.max=u,modelModifiers:{number:!0},type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):L("",!0),["text","textarea"].includes(t.type)?(s(),g(v,{key:2,label:"最大长度"},{default:a(()=>[l(y,{modelValue:t.maxLength,"onUpdate:modelValue":u=>t.maxLength=u,modelModifiers:{number:!0},type:"number",placeholder:"0表示不限制"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):L("",!0)])):L("",!0)],2))),128)),l(p,{type:"text",onClick:Q,style:{"margin-top":"10px"}},{default:a(()=>[l(J,null,{default:a(()=>[l(O(R))]),_:1}),e[19]||(e[19]=m(" 添加字段 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(j,{title:"表单预览",modelValue:q.value,"onUpdate:modelValue":e[9]||(e[9]=t=>q.value=t),width:"600px"},{footer:a(()=>[l(p,{onClick:e[8]||(e[8]=t=>q.value=!1)},{default:a(()=>[...e[22]||(e[22]=[m("关闭预览",-1)])]),_:1})]),default:a(()=>[w("div",Te,[w("h3",Ue,z(N.value.name),1),l(K,{model:F.value,"label-width":"100px"},{default:a(()=>[(s(!0),b(T,null,U(N.value.fields,(t,d)=>(s(),g(v,{key:d,label:t.label,required:t.required},{default:a(()=>[(s(),g(_e(A(t.type)),{modelValue:F.value[`field_${d}`],"onUpdate:modelValue":u=>F.value[`field_${d}`]=u,field:t},null,8,["modelValue","onUpdate:modelValue","field"]))]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},Fe=ce($e,[["__scopeId","data-v-70078e16"]]);export{Fe as default};
